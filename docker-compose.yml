version: "3.8"

services:
  nls-keycloak:
    image: ndwnls.azurecr.io/nls-keycloak-it-container:20221025.2
    command: -Djboss.http.port=8000
    hostname: nls-keycloak
    environment:
      - KEYCLOAK_USER=nls
      - KEYCLOAK_PASSWORD=nls
      - KEYCLOAK_IMPORT=/config/realm-export-nls.json
      - KEYCLOAK_FRONTEND_URL=http://nls-keycloak:8000/auth/
      - JAVA_OPTS_APPEND=-Dkeycloak.profile.feature.upload_scripts=enabled
      - DB_VENDOR=h2
    expose:
      - 8000
    ports:
      - "8000:8000"
    volumes:
      - ./docker/keycloak-local/config/realm-export-nls.json:/config/realm-export-nls.json
      - ./docker/keycloak-local/dump:/temp

  nls-accessibility-map-api:
    container_name: nls-accessibility-map-api
    hostname: nls-accessibility-map-api
    build: docker/nls-accessibility-map-api
    environment:
      - MANAGEMENT_DATADOG_METRICS_EXPORT_ENABLED=false
      - NLS_KEYCLOAK_URL=http://nls-keycloak:8000/auth
    ports:
      - "8080:8080"
    depends_on:
      - nls-keycloak
